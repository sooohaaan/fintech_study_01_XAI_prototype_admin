{% extends "base.html" %}
{% block content %}
<h1>포인트 구매 내역</h1>
<a href="/point-products" class="nav-btn mb-4">상품 목록으로 돌아가기</a>
<div class="info-banner">유저들의 포인트 상품 구매 내역을 조회합니다.</div>

<div class="summary-grid mb-6">
    <div class="summary-card">
        <div class="summary-label">총 구매 건수</div>
        <div class="summary-value">{{ total_purchases }}</div>
    </div>
    <div class="summary-card">
        <div class="summary-label">총 사용 포인트</div>
        <div class="summary-value text-danger">{{ "{:,}".format(total_points_used) }}P</div>
    </div>
</div>

<div class="table-wrapper">
    <table class="w-full">
        <thead><tr>
            <th>구매 ID</th>
            <th>유저 ID</th>
            <th>상품명</th>
            <th class="text-right">사용 포인트</th>
            <th class="text-center">상태</th>
            <th>구매일</th>
        </tr></thead>
        <tbody>
            {% for p in purchases %}
            <tr>
                <td>{{ p.purchase_id }}</td>
                <td class="font-bold">{{ p.user_id }}</td>
                <td>{{ p.product_name or '(삭제된 상품)' }}</td>
                <td class="text-right font-bold">{{ "{:,}".format(p.point_cost) }}P</td>
                <td class="text-center">
                    {% if p.status == 'completed' %}
                        <span class="badge badge-success">completed</span>
                    {% elif p.status == 'cancelled' %}
                        <span class="badge badge-neutral">cancelled</span>
                    {% else %}
                        <span class="badge badge-warning">{{ p.status }}</span>
                    {% endif %}
                </td>
                <td>{{ p.purchased_at }}</td>
            </tr>
            {% else %}
            <tr><td colspan="6" class="text-center text-sub p-4">구매 내역이 없습니다.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}