{% extends "base.html" %}
{% from "macros.html" import guide_card, filter_form, empty_state %}
{% block content %}
<h1>유저 스탯 관리</h1>
{{ guide_card("Data Management", "유저 금융 데이터 관리",
    "미션 자동 달성 여부를 판단하는 기준이 되는 유저의 금융 데이터(신용점수, DSR, 자산 연동 여부 등)를 관리합니다.",
    [
        {"title": "데이터 조회", "desc": "개별 유저의 신용점수·DSR·자산 연동 현황을 확인합니다."},
        {"title": "데이터 수정", "desc": "검토 후 필요한 항목을 직접 수정합니다."}
    ]) }}

{{ filter_form([
    {"type": "date", "name": "start_date", "value": start_date},
    {"type": "separator", "text": "~"},
    {"type": "date", "name": "end_date", "value": end_date}
], label="기간 설정:", submit_label="조회", submit_class="btn-primary",
   reset_url="/missions/deletion-logs", show_reset=true, reset_label="전체 기간", extra_class="mb-6") }}

<div class="table-wrapper">
    <table class="w-full">
        <thead><tr>
            <th>User ID</th>
            <th class="text-right">신용점수</th>
            <th class="text-right">DSR</th>
            <th class="text-right">카드사용률</th>
            <th class="text-center">연체</th>
            <th class="text-center">급여이체</th>
            <th class="text-center">관리</th>
        </tr></thead>
        <tbody>
            {% for s in stats %}
            <tr>
                <td class="font-bold">{{ s.user_id }}</td>
                <td class="text-right">{{ s.credit_score }}</td>
                <td class="text-right">{{ s.dsr }}%</td>
                <td class="text-right">{{ s.card_usage_rate }}%</td>
                <td class="text-center">{{ s.delinquency }}건</td>
                <td class="text-center">
                    {% if s.salary_transfer == 1 %}<span class="badge badge-success">Y</span>{% else %}<span class="badge badge-neutral">N</span>{% endif %}
                </td>
                <td class="text-center">
                    <a href="/user-stats/{{ s.user_id }}/edit" class="btn-tonal btn-sm">수정</a>
                </td>
            </tr>
            {% else %}
            {{ empty_state(7, "데이터가 없습니다.") }}
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}