{% extends "base.html" %}
{% from "macros.html" import guide_card, summary_grid, empty_state, pagination %}
{% block content %}
<h1>포인트 상품 관리</h1>

{{ guide_card("순환 구조", "포인트의 실질적 가치",
    "획득한 포인트가 쿠폰·금리 할인권 등 실제 혜택으로 교환될 수 있어야 합니다. 이 선순환 구조는 사용자가 TrustFin 생태계에 머무르게 하는 핵심 요인입니다.",
    [
        {"title": "상품 조회", "desc": "현재 등록된 포인트 교환 상품 목록을 확인합니다."},
        {"title": "상품 관리", "desc": "상품을 추가·수정하거나 노출 여부를 변경합니다."}
    ]) }}

{{ summary_grid([
    {"label": "전체 상품", "value": total_count},
    {"label": "활성 상품", "value": active_count, "color": "success"},
    {"label": "비활성 상품", "value": inactive_count, "color": "danger"}
], "mb-6", title="포인트 상품 현황", badge="Store") }}

<div class="flex gap-2 mb-6">
    <a href="/point-products/add" class="btn-accent">상품 추가</a>
    <a href="/point-products/purchases" class="nav-btn">구매 내역 조회</a>
</div>

<div class="table-wrapper">
    <table class="w-full">
        <thead><tr>
            <th>ID</th>
            <th>상품명</th>
            <th>유형</th>
            <th class="text-right">포인트 가격</th>
            <th class="text-right">재고</th>
            <th class="text-center">상태</th>
            <th class="text-center">관리</th>
        </tr></thead>
        <tbody>
            {% for p in products %}
            <tr>
                <td>{{ p.product_id }}</td>
                <td class="font-bold">{{ p.product_name }}</td>
                <td><span class="badge badge-info">{{ p.product_type }}</span></td>
                <td class="text-right font-bold">{{ "{:,}".format(p.point_cost) }}P</td>
                <td class="text-right {{ 'text-danger font-bold' if p.stock_quantity <= 5 else '' }}">{{ p.stock_quantity }}{{ ' (부족)' if p.stock_quantity <= 5 else '' }}</td>
                <td class="text-center">
                    {% if p.is_active == 1 %}
                        <span class="badge-on">활성</span>
                    {% else %}
                        <span class="badge-off">비활성</span>
                    {% endif %}
                </td>
                <td class="text-center">
                    <div class="flex gap-2 justify-center">
                        <a href="/point-products/{{ p.product_id }}/edit" class="btn-tonal btn-sm">수정</a>
                        <form action="/point-products/{{ p.product_id }}/toggle" method="post" class="form-inline">
                            <button type="submit" class="{{ 'btn-outline-danger' if p.is_active == 1 else 'btn-outline-success' }}">
                                {{ '비활성' if p.is_active == 1 else '활성' }}
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
            {% else %}
            {{ empty_state(7, "등록된 상품이 없습니다.") }}
            {% endfor %}
        </tbody>
    </table>
</div>

{{ pagination(page, total_pages,
    url_for('point_products', page=page-1),
    url_for('point_products', page=page+1)) }}
{% endblock %}