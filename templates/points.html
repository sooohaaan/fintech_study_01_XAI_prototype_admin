{% extends "base.html" %}
{% block content %}
<h1>포인트 관리</h1>

<div class="card guide-card">
    <div class="card-p">
        <div class="flex items-center gap-2 mb-2">
            <span class="badge badge-info">게이미피케이션</span>
            <h3 class="font-bold text-sm">보상 시스템과 동기 부여</h3>
        </div>
        <p class="text-sm text-sub">
            금융 활동은 지루하고 어렵게 느껴질 수 있습니다. 이를 극복하기 위해 <strong>포인트 보상 시스템</strong>을 도입했습니다. 미션 달성에 대한 즉각적인 보상(포인트)을 제공함으로써, 사용자가 지속적으로 금융 상태를 관리하고 개선하도록 <strong>동기를 부여</strong>합니다.
        </p>
    </div>
</div>

<div class="info-banner">유저별 포인트 잔액, 지급/사용 현황을 모니터링합니다.</div>

<div class="summary-grid mb-6">
    <div class="summary-card">
        <div class="summary-label">총 유저 수</div>
        <div class="summary-value">{{ user_count }}</div>
    </div>
    <div class="summary-card">
        <div class="summary-label">총 유통 포인트</div>
        <div class="summary-value">{{ "{:,}".format(total_balance) }}</div>
    </div>
    <div class="summary-card">
        <div class="summary-label">총 지급 포인트</div>
        <div class="summary-value text-success">{{ "{:,}".format(total_earned) }}</div>
    </div>
    <div class="summary-card">
        <div class="summary-label">총 사용 포인트</div>
        <div class="summary-value text-danger">{{ "{:,}".format(total_spent) }}</div>
    </div>
</div>

<div class="card card-p mb-6">
    <h3 class="card-title text-primary mt-0">수동 포인트 조정</h3>
    <div class="warn-banner">수동 포인트 조정은 즉시 반영되며 취소할 수 없습니다.</div>
    <form method="post" action="/points/adjust" class="flex gap-2 items-end flex-wrap">
        <div class="flex-1 min-w-150">
            <label class="form-label text-sm">유저 ID</label>
            <input type="text" name="user_id" placeholder="예: user_001" required class="form-input">
        </div>
        <div class="flex-1 min-w-120">
            <label class="form-label text-sm">금액 (양수=지급, 음수=차감)</label>
            <input type="number" name="amount" placeholder="예: 100 또는 -50" required class="form-input">
        </div>
        <div class="flex-2 min-w-200">
            <label class="form-label text-sm">사유</label>
            <input type="text" name="reason" placeholder="예: 이벤트 보상, 오류 정정" required class="form-input">
        </div>
        <button type="submit" class="btn-accent" style="padding: 10px 20px; white-space: nowrap;">포인트 조정</button>
    </form>
</div>

<div class="table-wrapper">
    <table class="w-full">
        <thead><tr>
            <th>유저 ID</th>
            <th class="text-right">잔액</th>
            <th class="text-right">총 지급</th>
            <th class="text-right">총 사용</th>
            <th>최근 업데이트</th>
            <th class="text-center">상세</th>
        </tr></thead>
        <tbody>
            {% for u in users %}
            <tr>
                <td class="font-bold">{{ u.user_id }}</td>
                <td class="text-right font-bold text-primary">{{ "{:,}".format(u.balance) }}</td>
                <td class="text-right text-success">{{ "{:,}".format(u.total_earned) }}</td>
                <td class="text-right text-danger">{{ "{:,}".format(u.total_spent) }}</td>
                <td>{{ u.updated_at if u.updated_at else '-' }}</td>
                <td class="text-center">
                    <a href="/points/{{ u.user_id }}" class="text-primary font-bold" style="text-decoration: none;">거래 내역</a>
                </td>
            </tr>
            {% else %}
            <tr><td colspan="6" class="text-center text-sub p-4">포인트 데이터가 없습니다.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}