{% extends "base.html" %}
{% from "macros.html" import guide_card %}
{% block content %}
    <h1>대출 추천 시뮬레이터</h1>

    {{ guide_card("Simulation Guide", "대출 추천 시뮬레이터",
        "현재 설정된 신용 평가 가중치와 추천 알고리즘이 실제 사용자에게 어떤 결과를 보여줄지 미리 검증합니다. 이 시뮬레이션은 실제 DB에 저장되지 않는 테스트용입니다.",
        [
            {"title": "프로필 입력", "desc": "소득, 희망 금액, 직업 등 가상의 사용자 정보를 입력합니다."},
            {"title": "추천 실행", "desc": "'추천 실행' 버튼을 눌러 알고리즘을 작동시킵니다."},
            {"title": "결과 확인", "desc": "추천 상품 목록, 예상 금리, AI 추천 사유(XAI)를 확인합니다."}
        ]) }}
    <div class="grid-1-2">
        <div class="card card-p h-fit">
            <h3 class="card-title mt-0 mb-4">가상 유저 프로필</h3>
            <form method="post">
                <label class="form-label">연소득 (원)</label>
                <input type="number" name="annual_income" value="{{ income }}" placeholder="예: 50000000" class="form-input mb-1">
                <p class="help-text mb-3">원 단위로 입력합니다.</p>
                <label class="form-label">희망 대출 금액 (원)</label>
                <input type="number" name="desired_amount" value="{{ amount }}" placeholder="예: 100000000" class="form-input mb-1">
                <p class="help-text mb-3">이 금액 이상을 지원하는 상품만 추천됩니다.</p>
                <label class="form-label">고용 형태 (안정성)</label>
                <select name="job_score" class="form-select mb-1">
                    <option value="1.0" {% if job_score == 1.0 %}selected{% endif %}>대기업/공무원 (매우 안정)</option>
                    <option value="0.8" {% if job_score == 0.8 %}selected{% endif %}>중견/중소기업 (안정)</option>
                    <option value="0.5" {% if job_score == 0.5 %}selected{% endif %}>프리랜서/계약직 (보통)</option>
                    <option value="0.2" {% if job_score == 0.2 %}selected{% endif %}>무직/기타 (불안정)</option>
                </select>
                <p class="help-text mb-3">고용 안정성 점수로 변환됩니다.</p>
                <label class="form-label">보유 자산 (원)</label>
                <input type="number" name="asset_amount" value="{{ asset_amount }}" placeholder="예: 200000000" class="form-input mb-1">
                <p class="help-text mb-3">부동산, 금융 자산 등 총액을 원 단위로 입력합니다.</p>
                <button type="submit" class="btn-accent w-full">추천 실행 (AI)</button>
            </form>
        </div>
        <div class="card card-p h-fit">
            <h3 class="card-title mt-0 mb-4">추천 결과</h3>
            {% if result_html %}
                <div class="table-wrapper">{{ result_html|safe }}</div>
                <p class="text-sub text-sm mt-2">* 예상 금리는 현재 설정된 가중치 정책과 유저 프로필에 따라 계산됩니다.</p>
            {% else %}
                <div class="bg-soft rounded-lg text-center text-muted p-4 dashed-border">왼쪽 폼에 정보를 입력하고 추천을 실행해보세요.</div>
            {% endif %}
        </div>
    </div>
{% endblock %}