{% extends "base.html" %}
{% block content %}
<h1>대출 상품 관리</h1>

<div class="card guide-card">
    <div class="card-p">
        <div class="flex items-center gap-2 mb-2">
            <span class="badge badge-info">운영 관리</span>
            <h3 class="font-bold text-sm">상품 노출 제어</h3>
        </div>
        <p class="text-sm text-sub">
            수집된 금융 상품 중 일시적으로 판매가 중단되거나 정책상 노출을 제한해야 하는 경우가 발생합니다. 관리자가 직접 상품의 노출 여부를 제어함으로써, 사용자에게 <strong>유효하고 정확한 정보</strong>만 제공되도록 관리합니다.
        </p>
    </div>
</div>

<div class="info-banner">수집된 대출 상품의 사용자 노출 여부를 관리합니다. 비노출 처리된 상품은 추천 결과에서 제외됩니다.</div>

<div class="summary-grid mb-6">
    <div class="summary-card" title="수집된 대출 상품의 전체 건수입니다.">
        <div class="summary-label">전체 상품</div>
        <div class="summary-value">{{ total_count }}</div>
    </div>
    <div class="summary-card" title="현재 사용자에게 노출 중인 상품 수입니다.">
        <div class="summary-label">노출 중</div>
        <div class="summary-value text-success">{{ visible_count }}</div>
    </div>
    <div class="summary-card">
        <div class="summary-label">비노출</div>
        <div class="summary-value text-danger">{{ hidden_count }}</div>
    </div>
</div>

<div class="flex justify-between items-center mb-6 flex-wrap gap-2">
    <form method="get" class="flex gap-2 items-center flex-wrap">
        <input type="text" name="search" value="{{ search }}" placeholder="은행 또는 상품명 검색..." class="form-input w-auto min-w-200">
        <button type="submit" class="btn-accent">검색</button>
        {% if search %}<a href="/products" class="nav-btn">초기화</a>{% endif %}
    </form>
</div>

<div class="table-wrapper">
    <table class="w-full">
    </div>
</div>

<div class="table-wrapper">
    <table class="w-full">
        <thead><tr>
            <th>은행</th>
            <th>상품명</th>
            <th class="text-right">최저 금리</th>
            <th class="text-right">최고 금리</th>
            <th class="text-right">대출 한도</th>
            <th class="text-center">상태</th>
            <th class="text-center">관리</th>
        </tr></thead>
        <tbody>
            {% for p in products %}
            <tr>
                <td>{{ p.bank_name }}</td>
                <td class="font-bold">{{ p.product_name }}</td>
                <td class="text-right">{{ p.loan_rate_min }}%</td>
                <td class="text-right">{{ p.loan_rate_max }}%</td>
                <td class="text-right">{{ "{:,.0f}".format(p.loan_limit) }}원</td>
                <td class="text-center">
                    {% if p.is_visible == 1 %}
                        <span class="badge badge-success">노출</span>
                    {% else %}
                        <span class="badge badge-danger">비노출</span>
                    {% endif %}
                </td>
                <td class="text-center">
                    <form action="/products/toggle_visibility" method="post" class="form-inline">
                        <input type="hidden" name="bank_name" value="{{ p.bank_name }}">
                        <input type="hidden" name="product_name" value="{{ p.product_name }}">
                        <button type="submit" class="{{ 'btn-outline-danger' if p.is_visible == 1 else 'btn-outline-success' }}">
                            {{ '비노출 처리' if p.is_visible == 1 else '노출 처리' }}
                        </button>
                    </form>
                </td>
            </tr>
            {% else %}
            <tr><td colspan="7" class="text-center text-sub p-4">등록된 상품이 없습니다.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="flex justify-between items-center mt-4">
    {% if page > 1 %}<a href="{{ url_for('products', page=page-1, search=search) }}" class="nav-btn">이전</a>
    {% else %}<span class="nav-btn" style="opacity: 0.5; cursor: default;">이전</span>{% endif %}
    <span class="text-sub font-bold">Page <span class="text-primary">{{ page }}</span> / {{ total_pages }}</span>
    {% if page < total_pages %}<a href="{{ url_for('products', page=page+1, search=search) }}" class="nav-btn">다음</a>
    {% else %}<span class="nav-btn" style="opacity: 0.5; cursor: default;">다음</span>{% endif %}
</div>
{% endblock %}